#!/usr/bin/env zsh
# File: ./usenet
# Usenet Media Stack - Main Entry Point
# 
# This is the ONLY script users should run directly.
# Everything else is internal implementation.
#
# Usage: usenet <command> [options]

set -euo pipefail

# Get absolute path to script directory
SCRIPT_DIR="${0:A:h}"
readonly SCRIPT_DIR

# Version
readonly VERSION="2.0.0"

# Source the help system
source "${SCRIPT_DIR}/lib/help.zsh" || {
    print -u2 "Error: Cannot find lib/help.zsh"
    exit 1
}

# Main command router
main() {
    local cmd="${1:-help}"
    shift || true
    
    case "$cmd" in
        # Core commands
        setup)
            exec "${SCRIPT_DIR}/lib/commands/setup.zsh" "$@"
            ;;
            
        manage)
            exec "${SCRIPT_DIR}/lib/commands/manage.zsh" "$@"
            ;;
            
        storage)
            exec "${SCRIPT_DIR}/lib/commands/storage.zsh" "$@"
            ;;
            
        # Convenience shortcuts
        status|logs|start|stop|restart)
            exec "${SCRIPT_DIR}/lib/commands/manage.zsh" "$cmd" "$@"
            ;;
            
        # Utility commands
        test)
            exec "${SCRIPT_DIR}/lib/commands/test.zsh" "$@"
            ;;
            
        deps|check-deps)
            exec "${SCRIPT_DIR}/lib/commands/deps.zsh" "$@"
            ;;
            
        update)
            exec "${SCRIPT_DIR}/lib/commands/update.zsh" "$@"
            ;;
            
        backup|restore)
            exec "${SCRIPT_DIR}/lib/commands/backup.zsh" "$cmd" "$@"
            ;;
            
        # Help system
        help|--help|-h)
            show_help "${1:-}"
            ;;
            
        version|--version|-v)
            show_version
            ;;
            
        # Unknown command
        *)
            print -u2 "Error: Unknown command '$cmd'"
            print -u2 "Try 'usenet help' for available commands"
            exit 1
            ;;
    esac
}

# Run main
main "$@"