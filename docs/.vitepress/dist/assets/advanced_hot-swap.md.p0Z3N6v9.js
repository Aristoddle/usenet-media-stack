import{_ as o,c as t,o as a,a2 as i}from"./chunks/framework.BUjRcKcJ.js";const p=JSON.parse('{"title":"Hot-Swap Procedures","description":"","frontmatter":{"title":"Hot-Swap Procedures","layout":"doc"},"headers":[],"relativePath":"advanced/hot-swap.md","filePath":"advanced/hot-swap.md","lastUpdated":1766050220000}'),s={name:"advanced/hot-swap.md"};function r(l,e,n,d,c,u){return a(),t("div",null,e[0]||(e[0]=[i('<h1 id="hot-swap-procedures" tabindex="-1">Hot-Swap Procedures <a class="header-anchor" href="#hot-swap-procedures" aria-label="Permalink to &quot;Hot-Swap Procedures&quot;">​</a></h1><p>The contents of <code>codex/collab/hot-swap.md</code> now live here with updates for current hardware detection routines and JBOD best practices.</p><h2 id="supported-storage-targets" tabindex="-1">Supported Storage Targets <a class="header-anchor" href="#supported-storage-targets" aria-label="Permalink to &quot;Supported Storage Targets&quot;">​</a></h2><ul><li><strong>ZFS pools</strong> using by-id path detection.</li><li><strong>Btrfs volumes</strong> configured via <code>btrfs filesystem show</code>.</li><li><strong>USB JBOD enclosures</strong> exposing disks through <code>lsblk -o NAME,MODEL</code>.</li></ul><h2 id="preparation-checklist" tabindex="-1">Preparation Checklist <a class="header-anchor" href="#preparation-checklist" aria-label="Permalink to &quot;Preparation Checklist&quot;">​</a></h2><ol><li>Confirm that <code>usenet storage list</code> returns the pool you plan to edit.</li><li>Ensure recent backups exist for both configuration and media volumes.</li><li>Verify that <code>systemd-udevd</code> rules are loaded for the enclosure.</li><li>If OneDrive comics sync is running (GVFS + rsync), wait for it to complete before any swap or reboot. Check <code>journalctl --user -u rsync-comics -f</code>.</li></ol><h2 id="swap-workflow" tabindex="-1">Swap Workflow <a class="header-anchor" href="#swap-workflow" aria-label="Permalink to &quot;Swap Workflow&quot;">​</a></h2><ol><li><strong>Identify the disk</strong><ul><li>Run <code>./usenet storage identify --serial &lt;SERIAL&gt;</code> to map the device.</li><li>Cross-check with <code>smartctl -a</code> for health metrics.</li></ul></li><li><strong>Mark the disk offline</strong><ul><li>For ZFS: <code>zfs offline poolname &lt;disk&gt;</code>.</li><li>For Btrfs: <code>btrfs device offline /mountpoint &lt;disk&gt;</code>.</li></ul></li><li><strong>Replace hardware</strong><ul><li>Physically swap the drive and confirm the new serial appears in <code>usenet storage list</code>.</li></ul></li><li><strong>Bring the disk online</strong><ul><li>Re-enable using the matching ZFS or Btrfs command.</li><li>Run <code>./usenet storage scrub --pool &lt;poolname&gt;</code> to validate integrity.</li></ul></li></ol><h2 id="automation-hooks" tabindex="-1">Automation Hooks <a class="header-anchor" href="#automation-hooks" aria-label="Permalink to &quot;Automation Hooks&quot;">​</a></h2><ul><li>The CLI fires hooks located in <code>lib/hooks/storage/</code> during swaps.</li><li>Custom notifications can be added by placing scripts in <code>lib/hooks/storage/post-swap.d/</code> with executable permissions.</li><li>Hooks receive environment variables describing pool, serial, and status.</li></ul><h2 id="post-swap-validation" tabindex="-1">Post-Swap Validation <a class="header-anchor" href="#post-swap-validation" aria-label="Permalink to &quot;Post-Swap Validation&quot;">​</a></h2><ul><li>Monitor Netdata for I/O anomalies over the first 24 hours.</li><li>Confirm Plex and download clients have access to restored mounts.</li><li>Schedule a SMART long test with <code>smartctl -t long</code> to baseline the disk.</li></ul><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><ul><li>If the disk fails to appear, reload the USB subsystem with <code>echo 0 | tee /sys/bus/usb/devices/&lt;id&gt;/authorized</code> followed by <code>1</code>.</li><li>For repeated enclosure resets, enable the optional UPS integration to rule out power fluctuations.</li></ul>',14)]))}const f=o(s,[["render",r]]);export{p as __pageData,f as default};
