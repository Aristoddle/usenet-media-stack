import{_ as s,c as a,o as e,a2 as t}from"./chunks/framework.BUjRcKcJ.js";const c=JSON.parse('{"title":"API Integration Guide","description":"","frontmatter":{"title":"API Integration Guide","layout":"doc"},"headers":[],"relativePath":"advanced/api-integration.md","filePath":"advanced/api-integration.md","lastUpdated":1766050220000}'),n={name:"advanced/api-integration.md"};function r(o,i,l,h,p,d){return e(),a("div",null,i[0]||(i[0]=[t(`<h1 id="api-integration-guide" tabindex="-1">API Integration Guide <a class="header-anchor" href="#api-integration-guide" aria-label="Permalink to &quot;API Integration Guide&quot;">​</a></h1><p>This document captures the automation patterns previously maintained in <code>codex/collab/api-integration.md</code>. The guidance has been validated against the production Usenet Media Stack CLI and current service versions.</p><h2 id="core-principles" tabindex="-1">Core Principles <a class="header-anchor" href="#core-principles" aria-label="Permalink to &quot;Core Principles&quot;">​</a></h2><ol><li><strong>Treat every service as stateless.</strong> Persist data in volumes that are already part of the storage profiles generated by <code>usenet storage</code>.</li><li><strong>Use the CLI as your entry point.</strong> The <code>./usenet services</code> commands ensure authentication, hostnames, and port mappings stay consistent.</li><li><strong>Respect rate limits.</strong> Public APIs such as Overseerr or Prowlarr enforce throttling; queue automation jobs instead of firing bursts.</li></ol><h2 id="service-authentication-matrix" tabindex="-1">Service Authentication Matrix <a class="header-anchor" href="#service-authentication-matrix" aria-label="Permalink to &quot;Service Authentication Matrix&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Service</th><th>Auth Source</th><th>Token Scope</th></tr></thead><tbody><tr><td>Overseerr</td><td><code>config/overseerr</code></td><td><code>read</code> + <code>manage</code></td></tr><tr><td>Prowlarr</td><td><code>config/prowlarr</code></td><td>Indexer CRUD</td></tr><tr><td>Sonarr/Radarr</td><td><code>config/*/config.xml</code></td><td>Full automation</td></tr><tr><td>Plex</td><td><code>config/plex</code></td><td>Library management</td></tr><tr><td>Bazarr</td><td><code>config/bazarr</code></td><td>Subtitle sync</td></tr></tbody></table><p>Tokens are rotated automatically when you run <code>./usenet backup create</code>. Store rotation logs in your password manager to keep track of changes.</p><h2 id="automation-workflow" tabindex="-1">Automation Workflow <a class="header-anchor" href="#automation-workflow" aria-label="Permalink to &quot;Automation Workflow&quot;">​</a></h2><ol><li>Request an API key through the service web UI.</li><li>Store the key in the <code>.env</code> overlay managed by <code>./usenet env edit</code>.</li><li>Extend the CLI by creating a shell script under <code>lib/commands</code> that exports <code>USENET_ENV</code> before invoking curl or python clients.</li><li>Add the script to the completions file so the command appears in the interactive help.</li></ol><h2 id="example-creating-a-custom-overseerr-import" tabindex="-1">Example: Creating a Custom Overseerr Import <a class="header-anchor" href="#example-creating-a-custom-overseerr-import" aria-label="Permalink to &quot;Example: Creating a Custom Overseerr Import&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/usr/bin/env bash</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -euo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pipefail</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;)/../lib/core/bootstrap.sh&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usenet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OVERSEERR_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usenet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> services</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> overseerr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$BASE_URL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/api/v1/imports&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-Api-Key: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$API_KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">library-sync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">enabled</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:true}&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Run the script with <code>./usenet custom overseerr-import</code>. The CLI context resolves the container hostname, so this works on localhost and tunnels.</p><h2 id="webhook-integration" tabindex="-1">Webhook Integration <a class="header-anchor" href="#webhook-integration" aria-label="Permalink to &quot;Webhook Integration&quot;">​</a></h2><ul><li>Prefer HTTPS webhooks through the Cloudflare tunnel exposed by the stack. Create DNS entries in <code>config/tunnel/records.yml</code>.</li><li>Queue heavy jobs with <code>usenet services exec &lt;service&gt; -- enqueue</code> to avoid blocking the webhook sender.</li><li>Version control webhook payloads alongside the scripts that consume them so you can diff changes triggered by upstream providers.</li></ul><h2 id="monitoring-and-auditing" tabindex="-1">Monitoring and Auditing <a class="header-anchor" href="#monitoring-and-auditing" aria-label="Permalink to &quot;Monitoring and Auditing&quot;">​</a></h2><ul><li>Enable Netdata integration by posting metrics to <code>localhost:8125</code>.</li><li>Log every automation run to <code>/var/log/usenet-automation.log</code> inside the control host. Forward logs with the existing Loki pipeline if enabled.</li><li>Review API key usage weekly; revoke stale credentials via the CLI.</li></ul>`,16)]))}const u=s(n,[["render",r]]);export{c as __pageData,u as default};
