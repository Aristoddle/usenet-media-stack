<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vNext Cluster Plan (PC + Laptops + 6‚Äì8 RPi5) | Beppe's Arr Stack</title>
    <meta name="description" content="Beppe's Arr: opinionated Usenet+torrent homelab stack with hot-swappable storage, GPU assist, and honest docs.">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.nMx7e82T.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.krbmO3cT.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CdJRaOjk.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BUjRcKcJ.js">
    <link rel="modulepreload" href="/assets/vnext-cluster-plan.md.C_Erwn01.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Beppe's Arr Stack">
    <meta property="og:description" content="Opinionated Usenet+torrent homelab stack with hot-swap storage and GPU assist">
    <meta property="og:image" content="https://images.squarespace-cdn.com/content/v1/6565030c0f2a89615e0be33d/fe9447b9-db94-4428-9713-6d2c7d146e2b/Monty2.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://beppesarrstack.net">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Beppe's Arr Stack">
    <meta name="twitter:description" content="Opinionated Usenet+torrent homelab stack with hot-swap storage and GPU assist.">
    <meta name="twitter:image" content="https://images.squarespace-cdn.com/content/v1/6565030c0f2a89615e0be33d/fe9447b9-db94-4428-9713-6d2c7d146e2b/Monty2.png">
    <meta name="keywords" content="media automation, docker, plex, sonarr, radarr, hot-swap, jbod, gpu acceleration">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" alt data-v-ab19afbb><!--]--><span data-v-9f43907a>Beppe&#39;s Arr Stack</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Home</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-bfe7971f><span class="text" data-v-bfe7971f><!----><span data-v-bfe7971f>Guides</span><span class="vpi-chevron-down text-icon" data-v-bfe7971f></span></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/getting-started/" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Quickstart</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/ops-runbook.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Ops Runbook</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/usenet-primer.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Usenet Primer</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/usenet-onboarding.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Usenet Onboarding</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/trash-guides.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>TRaSH Guides</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/reading-stack.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Reading Stack</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/books-reorg-plan.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Books Reorg Plan</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/TODO-komics-stack.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Komics TODO</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/faq.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>FAQ</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-bfe7971f><span class="text" data-v-bfe7971f><!----><span data-v-bfe7971f>Reference</span><span class="vpi-chevron-down text-icon" data-v-bfe7971f></span></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/cli/" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>CLI Reference</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/architecture/" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Architecture</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/advanced/" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Advanced</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/SERVICES/" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Service Status</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/local-endpoints.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Local Endpoints</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/visualizations.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Visualizations</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-bfe7971f><span class="text" data-v-bfe7971f><!----><span data-v-bfe7971f>Resources</span><span class="vpi-chevron-down text-icon" data-v-bfe7971f></span></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/free-media.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Free Media</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/secrets.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Secrets</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-bfe7971f><span class="text" data-v-bfe7971f><!----><span data-v-bfe7971f>Support</span><span class="vpi-chevron-down text-icon" data-v-bfe7971f></span></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link vp-external-link-icon" href="https://github.com/Aristoddle/usenet-media-stack/issues" target="_blank" rel="noreferrer" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Open an Issue</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link vp-external-link-icon" href="mailto:j3lanzone@gmail.com?subject=Help%20with%20media%20stack" target="_blank" rel="noreferrer" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Email Joe</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/Aristoddle/usenet-media-stack" target="_blank" rel="noreferrer" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>GitHub</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Aristoddle/usenet-media-stack" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Aristoddle/usenet-media-stack" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _vnext-cluster-plan" data-v-e6f2a212><div><h1 id="vnext-cluster-plan-pc-laptops-6‚Äì8-rpi5" tabindex="-1">vNext Cluster Plan (PC + Laptops + 6‚Äì8 RPi5) <a class="header-anchor" href="#vnext-cluster-plan-pc-laptops-6‚Äì8-rpi5" aria-label="Permalink to &quot;vNext Cluster Plan (PC + Laptops + 6‚Äì8 RPi5)&quot;">‚Äã</a></h1><h2 id="assumptions-non-goals-invariants" tabindex="-1">Assumptions / Non-goals / Invariants <a class="header-anchor" href="#assumptions-non-goals-invariants" aria-label="Permalink to &quot;Assumptions / Non-goals / Invariants&quot;">‚Äã</a></h2><ul><li>Content lives outside the stack; the repo must rehydrate ‚Äútools, not data‚Äù on any host.</li><li>State must be explicit (bind mounts), backed up, and reversible before deletion.</li><li>Boot must converge without babysitting: services wait for mounts, restart safely.</li><li>Security posture may differ by runtime: rootless acceptable for single-host; rootful required for Swarm/k8s nodes.</li></ul><h2 id="tl-dr" tabindex="-1">TL;DR <a class="header-anchor" href="#tl-dr" aria-label="Permalink to &quot;TL;DR&quot;">‚Äã</a></h2><ul><li>Keep today‚Äôs compose setup (Komga/Komf + Arr stack) on Podman/Docker with bind-mounted configs.</li><li>Post-reboot, enable Docker daemon for Swarm/K8s experiments.</li><li>Long-term: prefer <strong>k3s</strong> (lightweight Kubernetes) with PC control-plane, RPis as workers, laptops tainted/ephemeral. <a href="https://docs.k3s.io/" target="_blank" rel="noreferrer">k3s docs</a></li></ul><h2 id="why-k3s-over-swarm-for-this-hardware-mix" tabindex="-1">Why k3s over Swarm (for this hardware mix) <a class="header-anchor" href="#why-k3s-over-swarm-for-this-hardware-mix" aria-label="Permalink to &quot;Why k3s over Swarm (for this hardware mix)&quot;">‚Äã</a></h2><ul><li>Multi-arch &amp; edge-focused: single binary, minimal deps, ARM builds. <a href="https://docs.k3s.io/" target="_blank" rel="noreferrer">k3s docs</a> ¬∑ <a href="https://github.com/k3s-io/k3s" target="_blank" rel="noreferrer">k3s GitHub</a></li><li>Small control-plane footprint: k3s is positioned for edge/IoT; typical RAM use is markedly lower than full k8s. (Vendor positioning; measure on your hosts.)</li><li>Ecosystem depth (ingress, cert-manager, GitOps) and active velocity vs. Swarm‚Äôs slower cadence.</li><li>Swarm still supported (Mirantis committed through 2030) but <strong>rootless Swarm is unsupported</strong> because overlay networking is unavailable in rootless Docker. <a href="https://www.mirantis.com/blog/mirantis-guarantees-long-term-support-for-swarm/" target="_blank" rel="noreferrer">Mirantis LTS</a> ¬∑ <a href="https://docs.docker.com/engine/security/rootless/#known-limitations" target="_blank" rel="noreferrer">Docker rootless limitations</a></li></ul><h2 id="near-term-steps-before-cluster-work" tabindex="-1">Near-term steps (before cluster work) <a class="header-anchor" href="#near-term-steps-before-cluster-work" aria-label="Permalink to &quot;Near-term steps (before cluster work)&quot;">‚Äã</a></h2><ol><li>Make Komga/Komf runtime-agnostic: bind-mount <code>/config</code> and <code>/tmp</code>; drive paths via <code>.env</code> and <code>docker-compose.komga.yml</code>.</li><li>Keep compose as single source of truth; run with <code>podman compose</code> today, <code>docker compose</code> after reboot.</li><li>Post-reboot: enable Docker service + docker group; optional: keep Podman for dev/testing.</li><li>Stop generating single-container systemd units; prefer Quadlet or a user service that runs <code>podman compose up -d</code>. <a href="https://docs.podman.io/en/latest/markdown/podman-generate-systemd.1.html" target="_blank" rel="noreferrer">Podman systemd deprecation</a></li><li>Compose implementation: standardize on <strong>podman compose</strong> (v4+) with the Docker Compose V2 provider installed (<code>docker compose</code> in PATH) and <strong>docker compose v2</strong> on Docker hosts. Avoid the legacy <code>podman-compose</code> shim and avoid compose features known to differ (e.g., experimental <code>secrets</code> drivers); stick to v3.9 services/volumes/env/binds which both runtimes support. <a href="https://www.redhat.com/en/blog/podman-compose-docker-compose" target="_blank" rel="noreferrer">Red Hat compose guidance</a> ¬∑ <a href="https://docs.podman.io/en/v5.6.2/markdown/podman-compose.1.html" target="_blank" rel="noreferrer">podman-compose provider note</a></li></ol><h2 id="medium-term-k3s-bootstrap" tabindex="-1">Medium-term (k3s bootstrap) <a class="header-anchor" href="#medium-term-k3s-bootstrap" aria-label="Permalink to &quot;Medium-term (k3s bootstrap)&quot;">‚Äã</a></h2><ol><li>Install k3s on the PC (single control-plane).</li><li>Join RPi5s as workers; label/taint <code>arm64</code> / <code>low-mem</code>; fence laptops as ‚Äúburst-only‚Äù.</li><li>Storage: NFS share from PC; install NFS CSI and StorageClass. (Avoid distributed storage across RPis unless HA is required.)</li><li>Ingress/TLS: ingress-nginx + cert-manager.</li><li>Deploy Komga/Komf via Helm/Kustomize; reuse <code>COMICS_ROOT</code>, <code>KOMGA_CONFIG</code>, <code>KOMGA_TMP</code>.</li><li>CI/build: <code>docker buildx bake</code> multi-arch (amd64/arm64) ‚Üí GHCR; pull by platform in k3s.</li></ol><h2 id="swarm-fallback-if-you-choose-it" tabindex="-1">Swarm fallback (if you choose it) <a class="header-anchor" href="#swarm-fallback-if-you-choose-it" aria-label="Permalink to &quot;Swarm fallback (if you choose it)&quot;">‚Äã</a></h2><ul><li>Keep compose v3.9 files; add <code>deploy</code> blocks and placement constraints.</li><li>Run Swarm only in rootful Docker (rootless Swarm unsupported). <a href="https://docs.docker.com/engine/security/rootless/#known-limitations" target="_blank" rel="noreferrer">Docker rootless limitations</a></li><li>If using bind mounts, paths must exist on every node where tasks may land; otherwise pin tasks with placement constraints or use shared storage. <a href="https://docs.docker.com/engine/swarm/services/#bind-mounts" target="_blank" rel="noreferrer">Swarm bind-mount requirement</a></li><li>Note: <code>docker stack deploy</code> uses the legacy Compose v3 subset; avoid Compose-spec-only features or maintain a swarm-specific override file. <a href="https://docs.docker.com/engine/swarm/stack-deploy/" target="_blank" rel="noreferrer">Docker stack deploy</a></li></ul><h2 id="risks-mitigations" tabindex="-1">Risks / Mitigations <a class="header-anchor" href="#risks-mitigations" aria-label="Permalink to &quot;Risks / Mitigations&quot;">‚Äã</a></h2><ul><li>Path drift (new disk/NVMe): use <code>.env</code> for paths; avoid hardcoded systemd units.</li><li>Transient laptops: taint them; no critical pods scheduled there.</li><li>RPi thermal limits: use low resource requests/limits; keep control-plane off RPis.</li><li>Security: if you need rootless for dev, run rootless Docker/Podman for non-Swarm workloads; keep Swarm/k3s rootful on the PC.</li></ul><h2 id="next-actions-to-kick-off-after-reboot" tabindex="-1">Next actions to kick off after reboot <a class="header-anchor" href="#next-actions-to-kick-off-after-reboot" aria-label="Permalink to &quot;Next actions to kick off after reboot&quot;">‚Äã</a></h2><ul><li>Enable Docker; run compose using bind-mounted configs.</li><li>Export current Komga Podman volume ‚Üí host config dir; update compose/systemd to bind mounts.</li><li>Add <code>.env.example</code> with COMICS_ROOT/KOMGA_CONFIG/KOMGA_TMP defaults.</li><li>Draft k3s install/runbook (PC control-plane, RPi workers).</li></ul><h2 id="komga-config-migration-plan-only-do-post-reboot" tabindex="-1">Komga config migration (plan only; do post-reboot) <a class="header-anchor" href="#komga-config-migration-plan-only-do-post-reboot" aria-label="Permalink to &quot;Komga config migration (plan only; do post-reboot)&quot;">‚Äã</a></h2><ul><li>Stop service: <code>systemctl --user stop container-komga.service</code> (or <code>podman stop komga</code>).</li><li>Discover volume name: <code>podman volume ls</code> and note the Komga config volume; inspect if needed: <code>podman volume inspect &lt;VOL&gt;</code>.</li><li>Backup old volume (create backup dir first): <code>mkdir -p /srv/komga/backup</code> (or a user-writable path) then <code>podman run --rm -v &lt;VOL&gt;:/from -v /srv/komga/backup:/backup alpine sh -c &quot;cd /from &amp;&amp; tar cf /backup/komga-config.tar .&quot;</code></li><li>Ensure bind paths writable in rootless mode: either use a user-owned path (e.g., <code>$HOME/.local/share/komga/config</code> and <code>/tmp/komga</code>) or <code>sudo mkdir -p /srv/komga/{config,tmp,backup} &amp;&amp; sudo chown -R $(id -u):$(id -g) /srv/komga</code>.</li><li>Migrate to bind mounts: <code>podman run --rm -v &lt;VOL&gt;:/from -v /srv/komga/config:/to alpine sh -c &quot;cd /from &amp;&amp; tar cf - . | (cd /to &amp;&amp; tar xf -)&quot;</code> (repeat for <code>/tmp</code> if needed). On SELinux hosts keep <code>:Z</code> in compose; on non-SELinux hosts it is ignored.</li><li>Update <code>docker-compose.komga.yml</code> + <code>.env</code> to use bind mounts (<code>COMICS_ROOT</code>, <code>KOMGA_CONFIG=/srv/komga/config</code>, <code>KOMGA_TMP=/srv/komga/tmp</code> or <code>$HOME/.local/share/...</code>); recreate with compose (Podman or Docker).</li><li>Verify: login with existing user; libraries present; Komf reaches Komga; scan succeeds; thumbnails intact; check logs for errors.</li><li>Rollback (if needed): stop service, recreate container pointing back to the saved Podman volume or untar the backup into a fresh bind; keep the original volume until stable for several days.</li></ul><h2 id="mount-gating-and-boot-determinism" tabindex="-1">Mount gating and boot determinism <a class="header-anchor" href="#mount-gating-and-boot-determinism" aria-label="Permalink to &quot;Mount gating and boot determinism&quot;">‚Äã</a></h2><ul><li>Use a compose-based systemd (or Quadlet) user unit with <strong>literal absolute paths</strong> in <code>RequiresMountsFor=/path/to/mount</code> (no shell expansion in units) plus an <code>ExecStartPre</code> loop that waits for the mount (e.g., 30x5s). If the mount is missing, the unit should fail fast and systemd will retry; once the mount appears, <code>systemctl --user restart container-komga</code> succeeds without data loss. If templating is needed, generate the unit from <code>.env</code>.</li><li>For Swarm/K8s, ensure shared storage or placement constraints prevent scheduling on nodes without the bind path.</li></ul><h2 id="selinux-portability" tabindex="-1">SELinux portability <a class="header-anchor" href="#selinux-portability" aria-label="Permalink to &quot;SELinux portability&quot;">‚Äã</a></h2><ul><li>Default to <code>:Z</code> on bind mounts; on non-SELinux hosts it is ignored by Docker/Podman. If a host enforces SELinux and the path is shared, use <code>:z</code> only when multiple containers share the same content; otherwise keep <code>:Z</code>. Avoid applying :Z/üòí to broad/shared host paths to prevent unwanted relabeling. Document overrides in <code>.env.example</code> or a compose override for SELinux vs non-SELinux hosts.</li></ul><h2 id="runtime-note-for-k3s" tabindex="-1">Runtime note for k3s <a class="header-anchor" href="#runtime-note-for-k3s" aria-label="Permalink to &quot;Runtime note for k3s&quot;">‚Äã</a></h2><ul><li>In k3s the container runtime is containerd; Docker/Podman are for build/push and single-host runs. Build multi-arch images with <code>docker buildx</code> and push to GHCR; k3s pulls the right arch automatically.</li></ul><h2 id="compose-portability-podman-vs-docker" tabindex="-1">Compose portability (Podman vs Docker) <a class="header-anchor" href="#compose-portability-podman-vs-docker" aria-label="Permalink to &quot;Compose portability (Podman vs Docker)&quot;">‚Äã</a></h2><ul><li>Tested path: <code>podman compose</code> (v4+) and <code>docker compose v2</code>.</li><li>Avoid: legacy <code>podman-compose</code> python tool; compose features outside v3.9 core (e.g., experimental secrets drivers, swarm-only networking assumptions) when running on Podman.</li></ul><h2 id="definition-of-done-post-reboot" tabindex="-1">Definition of Done (post-reboot) <a class="header-anchor" href="#definition-of-done-post-reboot" aria-label="Permalink to &quot;Definition of Done (post-reboot)&quot;">‚Äã</a></h2><ul><li>Fresh clone + <code>.env</code> ‚Üí <code>docker compose -f docker-compose.komga.yml up -d</code> (or <code>podman compose ...</code>) succeeds.</li><li>Komga/Komf survive reboot with mounts present; if mounts absent, services do not corrupt state and recover automatically once mounts return.</li><li>Migration validated: existing user login works, libraries present, scan succeeds, Komf enrichment works, thumbnails intact.</li><li>Backup/restore tested once (using the tar backup) on a throwaway path.</li></ul></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Aristoddle/usenet-media-stack/edit/main/docs/vnext-cluster-plan.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-1bb0c8a8>Updated at: <time datetime="2025-12-13T21:25:44.000Z" data-v-1bb0c8a8></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-d8b57b2d data-v-566314d4><div class="container" data-v-566314d4><p class="message" data-v-566314d4>Built with ‚ù§Ô∏è following Bell Labs standards. Dedicated to Stan Eisenstat.</p><p class="copyright" data-v-566314d4>Copyright ¬© 2025 Joseph Lanzone. MIT Licensed.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"advanced_api-integration.md\":\"DrukS8vS\",\"advanced_backup-strategies.md\":\"CdloAT4_\",\"advanced_custom-configs.md\":\"BZI7z96t\",\"advanced_hot-swap.md\":\"p0Z3N6v9\",\"advanced_index.md\":\"BK5LpQl2\",\"advanced_migration-log.md\":\"BCOfMgyY\",\"advanced_performance.md\":\"CHDIX4pE\",\"advanced_troubleshooting.md\":\"DfuyLXB8\",\"architecture_index.md\":\"CIL_4Zw1\",\"books-reorg-plan.md\":\"U6XzJqDM\",\"cli_index.md\":\"C5_vtD8o\",\"cli_storage.md\":\"CR4wHMIU\",\"compatibility.md\":\"DOBDvfiG\",\"faq.md\":\"CCdXuQ50\",\"free-media.md\":\"GIlb_HOY\",\"getting-started_first-deployment.md\":\"xBnhjYVu\",\"getting-started_index.md\":\"BqSKS7h6\",\"getting-started_installation.md\":\"MT_TU8Ih\",\"hardware_index.md\":\"D2mg29-F\",\"index.md\":\"C1It-RPW\",\"komga.md\":\"C911j-5V\",\"local-endpoints.md\":\"CAQK5oem\",\"ops-runbook.md\":\"D1a-c7YU\",\"reading-stack.md\":\"DWbQ29N7\",\"runbook_dev-environment.md\":\"DLHXgH1L\",\"runbook_wiring_notes.md\":\"C_ZXQ2b-\",\"secrets.md\":\"zSa1VWWo\",\"security.md\":\"D_IXyHvT\",\"services.md\":\"7YhM5ifY\",\"storage_index.md\":\"BYC0FTwc\",\"swarm_quickstart.md\":\"POwnTywG\",\"todo-komics-stack.md\":\"BByAS09B\",\"trash-guides.md\":\"D1_vOoAF\",\"usenet-onboarding.md\":\"BW3y52Eq\",\"usenet-primer.md\":\"CWKchzMK\",\"visualizations.md\":\"BX32ITyA\",\"vnext-cluster-plan.md\":\"C_Erwn01\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Beppe's Arr Stack\",\"description\":\"Beppe's Arr: opinionated Usenet+torrent homelab stack with hot-swappable storage, GPU assist, and honest docs.\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Guides\",\"items\":[{\"text\":\"Quickstart\",\"link\":\"/getting-started/\"},{\"text\":\"Ops Runbook\",\"link\":\"/ops-runbook\"},{\"text\":\"Usenet Primer\",\"link\":\"/usenet-primer\"},{\"text\":\"Usenet Onboarding\",\"link\":\"/usenet-onboarding\"},{\"text\":\"TRaSH Guides\",\"link\":\"/trash-guides\"},{\"text\":\"Reading Stack\",\"link\":\"/reading-stack\"},{\"text\":\"Books Reorg Plan\",\"link\":\"/books-reorg-plan\"},{\"text\":\"Komics TODO\",\"link\":\"/TODO-komics-stack\"},{\"text\":\"FAQ\",\"link\":\"/faq\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"CLI Reference\",\"link\":\"/cli/\"},{\"text\":\"Architecture\",\"link\":\"/architecture/\"},{\"text\":\"Advanced\",\"link\":\"/advanced/\"},{\"text\":\"Service Status\",\"link\":\"/SERVICES/\"},{\"text\":\"Local Endpoints\",\"link\":\"/local-endpoints\"},{\"text\":\"Visualizations\",\"link\":\"/visualizations\"}]},{\"text\":\"Resources\",\"items\":[{\"text\":\"Free Media\",\"link\":\"/free-media\"},{\"text\":\"Secrets\",\"link\":\"/secrets\"}]},{\"text\":\"Support\",\"items\":[{\"text\":\"Open an Issue\",\"link\":\"https://github.com/Aristoddle/usenet-media-stack/issues\"},{\"text\":\"Email Joe\",\"link\":\"mailto:j3lanzone@gmail.com?subject=Help%20with%20media%20stack\"}]},{\"text\":\"GitHub\",\"link\":\"https://github.com/Aristoddle/usenet-media-stack\"}],\"sidebar\":{\"/getting-started/\":[{\"text\":\"üöÄ Getting Started\",\"items\":[{\"text\":\"Quick Start\",\"link\":\"/getting-started/\"},{\"text\":\"Prerequisites\",\"link\":\"/getting-started/prerequisites\"},{\"text\":\"Installation\",\"link\":\"/getting-started/installation\"},{\"text\":\"First Deployment\",\"link\":\"/getting-started/first-deployment\"}]}],\"/cli/\":[{\"text\":\"üìã CLI Reference\",\"items\":[{\"text\":\"Overview\",\"link\":\"/cli/\"},{\"text\":\"Deploy Command\",\"link\":\"/cli/deploy\"},{\"text\":\"Storage Management\",\"link\":\"/cli/storage\"},{\"text\":\"Hardware Optimization\",\"link\":\"/cli/hardware\"},{\"text\":\"Backup & Restore\",\"link\":\"/cli/backup\"},{\"text\":\"Service Management\",\"link\":\"/cli/services\"},{\"text\":\"Validation\",\"link\":\"/cli/validate\"}]}],\"/architecture/\":[{\"text\":\"üèóÔ∏è Architecture\",\"items\":[{\"text\":\"System Overview\",\"link\":\"/architecture/\"},{\"text\":\"CLI Design\",\"link\":\"/architecture/cli-design\"},{\"text\":\"Service Architecture\",\"link\":\"/architecture/services\"},{\"text\":\"Storage System\",\"link\":\"/architecture/storage\"},{\"text\":\"Hardware Integration\",\"link\":\"/architecture/hardware\"},{\"text\":\"Network & Security\",\"link\":\"/architecture/network\"}]}],\"/advanced/\":[{\"text\":\"üîß Advanced Topics\",\"items\":[{\"text\":\"Overview\",\"link\":\"/advanced/\"},{\"text\":\"Custom Configurations\",\"link\":\"/advanced/custom-configs\"},{\"text\":\"Performance Tuning\",\"link\":\"/advanced/performance\"},{\"text\":\"Backup Strategies\",\"link\":\"/advanced/backup-strategies\"},{\"text\":\"Hot-Swap Workflows\",\"link\":\"/advanced/hot-swap\"},{\"text\":\"Usenet Onboarding\",\"link\":\"/usenet-onboarding\"},{\"text\":\"API Integration\",\"link\":\"/advanced/api-integration\"},{\"text\":\"Troubleshooting\",\"link\":\"/advanced/troubleshooting\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Aristoddle/usenet-media-stack\"}],\"footer\":{\"message\":\"Built with ‚ù§Ô∏è following Bell Labs standards. Dedicated to Stan Eisenstat.\",\"copyright\":\"Copyright ¬© 2025 Joseph Lanzone. MIT Licensed.\"},\"search\":{\"provider\":\"local\"},\"editLink\":{\"pattern\":\"https://github.com/Aristoddle/usenet-media-stack/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"},\"lastUpdated\":{\"text\":\"Updated at\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>